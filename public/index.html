<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARC Classes | Ankit Sir</title>
    <style>
        :root { --primary: #0a192f; --gold: #ffd700; --light: #e6f1ff; }
        body { margin: 0; font-family: sans-serif; background: var(--primary); color: var(--light); }
        
        /* LAYOUT */
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        .section { display: none; }
        .active-section { display: block; animation: fadeIn 0.5s; }
        
        /* HEADER & NAV */
        header { background: #112240; padding: 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--gold); }
        .logo { font-size: 24px; font-weight: bold; color: var(--gold); }
        nav button { background: none; border: none; color: white; margin-left: 10px; cursor: pointer; font-size: 16px; }
        nav button:hover { color: var(--gold); }
        
        /* FORMS */
        .form-box { background: #112240; padding: 30px; border-radius: 10px; max-width: 400px; margin: 50px auto; border: 1px solid var(--gold); }
        input, select, textarea { width: 100%; padding: 10px; margin: 10px 0; background: #0a192f; border: 1px solid #333; color: white; box-sizing: border-box; }
        button.btn { width: 100%; padding: 12px; cursor: pointer; font-weight: bold; border: none; border-radius: 5px; margin-top: 10px; }
        .btn-gold { background: var(--gold); color: black; }
        .btn-red { background: #ff4444; color: white; }
        .btn-green { background: #00C851; color: white; }

        /* CARDS (For Schedule/Results) */
        .card { background: #112240; padding: 15px; margin-bottom: 10px; border-left: 4px solid var(--gold); display: flex; justify-content: space-between; align-items: center; }
        .card a { color: var(--gold); text-decoration: none; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <header>
        <div class="logo">ARC CLASSES</div>
        <nav id="nav-menu">
            </nav>
    </header>

    <div class="container">

        <div id="login" class="section active-section">
            <div class="form-box">
                <h2 style="text-align:center; color:var(--gold);">Login</h2>
                
                <div style="display:flex; margin-bottom:15px;">
                    <button onclick="setRole('student')" id="tab-student" class="btn btn-gold">Student</button>
                    <button onclick="setRole('admin')" id="tab-admin" class="btn" style="background:#333; color:white;">Teacher</button>
                </div>

                <input id="l-user" placeholder="Username (e.g. rahul123)">
                <input id="l-pass" type="password" placeholder="Password">
                <button onclick="doLogin()" class="btn btn-gold">Login</button>
            </div>
        </div>

        <div id="home" class="section">
            <h2>üì¢ Updates & Schedule</h2>
            <div id="student-schedule-list">Loading...</div>
            
            <h2>üèÜ Results</h2>
            <div id="student-result-list">Loading...</div>

            <h2>üìù Blogs</h2>
            <div id="student-blog-list">Loading...</div>
        </div>

        <div id="admin" class="section">
            <h2>Admin Panel</h2>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:20px;">
                <button onclick="showAdminSection('adm-create')" class="btn btn-gold">‚ûï Create Student</button>
                <button onclick="showAdminSection('adm-schedule')" class="btn btn-gold">üìÖ Manage Schedule</button>
                <button onclick="showAdminSection('adm-results')" class="btn btn-gold">üèÜ Manage Results</button>
                <button onclick="showAdminSection('adm-blogs')" class="btn btn-gold">üìù Manage Blogs</button>
            </div>

            <div id="adm-create" class="admin-sub" style="display:none;">
                <div class="form-box" style="margin:0;">
                    <h3>Create New Student</h3>
                    <input id="new-name" placeholder="Full Name">
                    <input id="new-user" placeholder="Username">
                    <input id="new-pass" placeholder="Password">
                    <input id="new-batch" placeholder="Batch (e.g. 2026)">
                    <button onclick="createStudent()" class="btn btn-green">Create User</button>
                </div>
            </div>

            <div id="adm-schedule" class="admin-sub" style="display:none;">
                <h3>Manage Schedule</h3>
                <input id="sch-title" placeholder="Topic / Title">
                <input id="sch-date" type="date">
                <input id="sch-link" placeholder="Link (Zoom/Drive) - Optional">
                <button onclick="addPost('schedule')" class="btn btn-green">Add Schedule</button>
                <div id="admin-schedule-list" style="margin-top:20px;"></div>
            </div>

            <div id="adm-results" class="admin-sub" style="display:none;">
                <h3>Upload Results</h3>
                <input id="res-title" placeholder="Exam Name">
                <input id="res-link" placeholder="Google Drive Link">
                <button onclick="addPost('result')" class="btn btn-green">Publish Result</button>
                <div id="admin-result-list" style="margin-top:20px;"></div>
            </div>
            
            <div id="adm-blogs" class="admin-sub" style="display:none;">
                <h3>Write Blog</h3>
                <input id="blog-title" placeholder="Blog Title">
                <textarea id="blog-content" rows="5" placeholder="Write content here..."></textarea>
                <button onclick="addPost('blog')" class="btn btn-green">Publish Blog</button>
                <div id="admin-blog-list" style="margin-top:20px;"></div>
            </div>
        </div>

    </div>

    <script>
        let currentRole = 'student';
        let currentUser = null;

        // --- NAVIGATION ---
        function show(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active-section'));
            document.getElementById(id).classList.add('active-section');
            updateNav();
        }

        function updateNav() {
            const nav = document.getElementById('nav-menu');
            if (!currentUser) {
                nav.innerHTML = '';
            } else if (currentUser.role === 'admin') {
                nav.innerHTML = `<button onclick="show('admin')">Dashboard</button><button onclick="logout()">Logout</button>`;
            } else {
                nav.innerHTML = `<button onclick="show('home')">Home</button><button onclick="logout()">Logout</button>`;
            }
        }

        // --- LOGIN LOGIC ---
        function setRole(role) {
            currentRole = role;
            document.getElementById('tab-student').style.background = role === 'student' ? '#ffd700' : '#333';
            document.getElementById('tab-admin').style.background = role === 'admin' ? '#ffd700' : '#333';
        }

        async function doLogin() {
            const username = document.getElementById('l-user').value;
            const password = document.getElementById('l-pass').value;

            // Admin Logic (Frontend Check for speed, verified on backend)
            if(currentRole === 'admin' && username === 'admin' && password === 'admin123') {
                loginSuccess({ name: 'Ankit Sir', role: 'admin' });
                return;
            }

            // Student Logic (Fetch)
            try {
                const res = await fetch('/api/login', {
                    method: 'POST', headers: {'Content-Type':'application/json'},
                    body: JSON.stringify({ username, password, role: currentRole })
                });
                const data = await res.json();
                if(data.success) loginSuccess(data);
                else alert(data.message);
            } catch(e) { alert("Server Connection Error"); }
        }

        function loginSuccess(user) {
            currentUser = user;
            localStorage.setItem('arcUser', JSON.stringify(user));
            if(user.role === 'admin') {
                show('admin');
                loadAdminData();
            } else {
                show('home');
                loadStudentData();
            }
        }

        function logout() {
            localStorage.removeItem('arcUser');
            currentUser = null;
            location.reload();
        }

        // --- ADMIN FUNCTIONS ---
        function showAdminSection(id) {
            document.querySelectorAll('.admin-sub').forEach(d => d.style.display = 'none');
            document.getElementById(id).style.display = 'block';
        }

        async function createStudent() {
            const name = document.getElementById('new-name').value;
            const username = document.getElementById('new-user').value;
            const password = document.getElementById('new-pass').value;
            const batch = document.getElementById('new-batch').value;

            const res = await fetch('/api/create-student', {
                method:'POST', headers:{'Content-Type':'application/json'},
                body: JSON.stringify({ name, username, password, batch })
            });
            const data = await res.json();
            alert(data.message);
            if(data.success) document.getElementById('new-name').value = ''; // Clear form
        }

        async function addPost(type) {
            let title, content, date;
            
            if(type === 'schedule') {
                title = document.getElementById('sch-title').value;
                date = document.getElementById('sch-date').value;
                content = document.getElementById('sch-link').value;
            } else if (type === 'result') {
                title = document.getElementById('res-title').value;
                content = document.getElementById('res-link').value;
                date = new Date().toLocaleDateString();
            } else {
                title = document.getElementById('blog-title').value;
                content = document.getElementById('blog-content').value;
                date = new Date().toLocaleDateString();
            }

            await fetch('/api/posts', {
                method:'POST', headers:{'Content-Type':'application/json'},
                body: JSON.stringify({ type, title, content, date })
            });
            alert("Added!");
            loadAdminData(); // Refresh lists
        }

        async function deletePost(id) {
            if(!confirm("Delete this?")) return;
            await fetch('/api/posts/' + id, { method: 'DELETE' });
            loadAdminData();
        }

        // --- DATA LOADING ---
        async function loadAdminData() {
            // Load all lists for admin
            loadList('schedule', 'admin-schedule-list', true);
            loadList('result', 'admin-result-list', true);
            loadList('blog', 'admin-blog-list', true);
        }

        async function loadStudentData() {
            loadList('schedule', 'student-schedule-list', false);
            loadList('result', 'student-result-list', false);
            loadList('blog', 'student-blog-list', false);
        }

        async function loadList(type, elementId, isAdmin) {
            const res = await fetch('/api/posts/' + type);
            const data = await res.json();
            const el = document.getElementById(elementId);
            
            el.innerHTML = data.map(item => `
                <div class="card">
                    <div>
                        <strong>${item.title}</strong> <small>(${item.date})</small><br>
                        ${item.type === 'blog' ? item.content.substring(0,50)+'...' : `<a href="${item.content}" target="_blank">Open Link</a>`}
                    </div>
                    ${isAdmin ? `<button class="btn-red" style="width:auto; padding:5px;" onclick="deletePost('${item._id}')">Delete</button>` : ''}
                </div>
            `).join('');
        }

        // Check Login on Load
        const saved = localStorage.getItem('arcUser');
        if(saved) loginSuccess(JSON.parse(saved));

    </script>
</body>
</html>